# Feature Specification: Assessment Features

**Version**: 1.0  
**Status**: Proposal  
**Last Updated**: 2025-11-11  
**Related Proposal**: [core-features-proposal.md](./core-features-proposal.md)

---

## Overview

DiagnoLeadsã®è¨ºæ–­æ©Ÿèƒ½ã®å®Œå…¨ãªä»•æ§˜ã‚’å®šç¾©ã—ã¾ã™ã€‚è¨ºæ–­ã®ä½œæˆã€ç·¨é›†ã€å…¬é–‹ã€ãƒ“ãƒ«ãƒ€ãƒ¼UIã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚’å«ã¿ã¾ã™ã€‚

---

## User Stories

### US-ASSESS-1: è¨ºæ–­ä¸€è¦§è¡¨ç¤º
**As a** ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†è€…  
**I want to** è‡ªåˆ†ã®ãƒ†ãƒŠãƒ³ãƒˆã®è¨ºæ–­ä¸€è¦§ã‚’è¦‹ãŸã„  
**So that** æ—¢å­˜ã®è¨ºæ–­ã‚’ç®¡ç†ã§ãã‚‹

**Acceptance Criteria:**
- [ ] è¨ºæ–­ä¸€è¦§ãŒãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] å„è¨ºæ–­ã«ä»¥ä¸‹ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹: ã‚¿ã‚¤ãƒˆãƒ«ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ä½œæˆæ—¥ã€æ›´æ–°æ—¥ã€å®Œäº†æ•°
- [ ] ã€Œæ–°è¦ä½œæˆã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ãŒã‚ã‚‹

### US-ASSESS-2: è¨ºæ–­ä½œæˆ
**As a** ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†è€…  
**I want to** æ–°ã—ã„è¨ºæ–­ã‚’ä½œæˆã—ãŸã„  
**So that** é¡§å®¢ã«ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚’æä¾›ã§ãã‚‹

**Acceptance Criteria:**
- [ ] ã€Œæ–°è¦ä½œæˆã€ãƒœã‚¿ãƒ³ã§ä½œæˆãƒšãƒ¼ã‚¸ã«é·ç§»
- [ ] åŸºæœ¬æƒ…å ±ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜ã€ã‚«ãƒ†ã‚´ãƒªï¼‰
- [ ] è³ªå•è¿½åŠ æ©Ÿèƒ½
- [ ] å›ç­”é¸æŠè‚¢è¿½åŠ æ©Ÿèƒ½
- [ ] ä¸‹æ›¸ãä¿å­˜æ©Ÿèƒ½
- [ ] å…¬é–‹/éå…¬é–‹åˆ‡ã‚Šæ›¿ãˆ

### US-ASSESS-3: è¨ºæ–­ãƒ“ãƒ«ãƒ€ãƒ¼
**As a** ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†è€…  
**I want to** ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿ã§è¨ºæ–­ã‚’æ§‹ç¯‰ã—ãŸã„  
**So that** ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸è¦ã§è¤‡é›‘ãªè¨ºæ–­ã‚’ä½œæˆã§ãã‚‹

**Acceptance Criteria:**
- [ ] ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§è³ªå•ã‚’ä¸¦ã³æ›¿ãˆ
- [ ] è³ªå•ã‚¿ã‚¤ãƒ—ã®é¸æŠï¼ˆå˜ä¸€é¸æŠã€è¤‡æ•°é¸æŠã€è‡ªç”±è¨˜è¿°ï¼‰
- [ ] æ¡ä»¶åˆ†å²ã®è¨­å®š
- [ ] ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã®è¨­å®š
- [ ] ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½

### US-ASSESS-4: è¨ºæ–­ç·¨é›†
**As a** ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†è€…  
**I want to** æ—¢å­˜ã®è¨ºæ–­ã‚’ç·¨é›†ã—ãŸã„  
**So that** å†…å®¹ã‚’æ”¹å–„ãƒ»æ›´æ–°ã§ãã‚‹

**Acceptance Criteria:**
- [ ] ä¸€è¦§ã‹ã‚‰è¨ºæ–­ã‚’é¸æŠã—ã¦ç·¨é›†ãƒšãƒ¼ã‚¸ã«é·ç§»
- [ ] æ—¢å­˜ã®æƒ…å ±ãŒå…¥åŠ›ã•ã‚ŒãŸçŠ¶æ…‹ã§è¡¨ç¤º
- [ ] å¤‰æ›´ã‚’ä¿å­˜ã§ãã‚‹
- [ ] å¤‰æ›´ã‚’ç ´æ£„ã§ãã‚‹ï¼ˆç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼‰

### US-ASSESS-5: è¨ºæ–­å…¬é–‹ç®¡ç†
**As a** ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†è€…  
**I want to** è¨ºæ–­ã®å…¬é–‹/éå…¬é–‹ã‚’ç®¡ç†ã—ãŸã„  
**So that** æº–å‚™ãŒæ•´ã£ãŸã‚‚ã®ã ã‘ã‚’å…¬é–‹ã§ãã‚‹

**Acceptance Criteria:**
- [ ] å…¬é–‹/éå…¬é–‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®åˆ‡ã‚Šæ›¿ãˆ
- [ ] å…¬é–‹å‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯ï¼‰
- [ ] å…¬é–‹URLã®è¡¨ç¤ºãƒ»ã‚³ãƒ”ãƒ¼
- [ ] åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆ

---

## Functional Requirements

### FR-ASSESS-1: Assessment List Page

**è¡¨ç¤ºå†…å®¹:**
| ã‚«ãƒ©ãƒ  | èª¬æ˜ | ã‚½ãƒ¼ãƒˆå¯å¦ |
|--------|------|----------|
| ã‚¿ã‚¤ãƒˆãƒ« | è¨ºæ–­å | âœ… |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ä¸‹æ›¸ã/å…¬é–‹ä¸­/éå…¬é–‹ | âœ… |
| å®Œäº†æ•° | è¨ºæ–­å®Œäº†å›æ•° | âœ… |
| ä½œæˆæ—¥ | ä½œæˆæ—¥æ™‚ | âœ… |
| æ›´æ–°æ—¥ | æœ€çµ‚æ›´æ–°æ—¥æ™‚ | âœ… |
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | ç·¨é›†/å‰Šé™¤/è¤‡è£½/å…¬é–‹åˆ‡æ›¿ | - |

**ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°:**
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã™ã¹ã¦ã€å…¬é–‹ä¸­ã€ä¸‹æ›¸ãã€éå…¬é–‹ï¼‰
- ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿
- æ—¥ä»˜ç¯„å›²ãƒ•ã‚£ãƒ«ã‚¿

**æ¤œç´¢:**
- ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜æ–‡ã®å…¨æ–‡æ¤œç´¢
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ï¼ˆ300msãƒ‡ãƒã‚¦ãƒ³ã‚¹ï¼‰

**ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³:**
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20ä»¶/ãƒšãƒ¼ã‚¸
- ã‚ªãƒ—ã‚·ãƒ§ãƒ³: 10, 20, 50, 100ä»¶

### FR-ASSESS-2: Assessment Creation Flow

**Step 1: åŸºæœ¬æƒ…å ±**
- ã‚¿ã‚¤ãƒˆãƒ« (å¿…é ˆ, max 200æ–‡å­—)
- èª¬æ˜ (ä»»æ„, max 1000æ–‡å­—)
- ã‚«ãƒ†ã‚´ãƒª (é¸æŠ, ä¾‹: ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã€å–¶æ¥­ã€æŠ€è¡“)
- ã‚¿ã‚° (ä»»æ„, è¤‡æ•°é¸æŠ)

**Step 2: è³ªå•ä½œæˆ**
- è³ªå•è¿½åŠ ãƒœã‚¿ãƒ³
- è³ªå•ã‚¿ã‚¤ãƒ—é¸æŠ:
  - å˜ä¸€é¸æŠï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ï¼‰
  - è¤‡æ•°é¸æŠï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
  - è‡ªç”±è¨˜è¿°ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ï¼‰
  - ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆ1-10ï¼‰
- è³ªå•æ–‡å…¥åŠ›
- å›ç­”é¸æŠè‚¢è¿½åŠ ï¼ˆå˜ä¸€/è¤‡æ•°é¸æŠã®å ´åˆï¼‰
- å¿…é ˆ/ä»»æ„è¨­å®š

**Step 3: ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°è¨­å®š**
- å„å›ç­”ã«ã‚¹ã‚³ã‚¢ã‚’è¨­å®š
- ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯:
  - åˆè¨ˆç‚¹æ–¹å¼
  - ã‚«ãƒ†ã‚´ãƒªåˆ¥è©•ä¾¡
  - ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

**Step 4: çµæœãƒšãƒ¼ã‚¸è¨­å®š**
- çµæœã‚¿ã‚¤ãƒˆãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- çµæœèª¬æ˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- ã‚¹ã‚³ã‚¢ç¯„å›²åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ãƒªãƒ¼ãƒ‰æƒ…å ±åé›†ãƒ•ã‚©ãƒ¼ãƒ è¨­å®š

**Step 5: ç¢ºèªãƒ»ä¿å­˜**
- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
- ä¸‹æ›¸ãä¿å­˜ or å…¬é–‹

### FR-ASSESS-3: Assessment Builder UI

**å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼: è³ªå•ãƒªã‚¹ãƒˆ**
- è³ªå•ä¸€è¦§ï¼ˆãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ï¼‰
- ã€Œè³ªå•ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³
- è³ªå•ã®å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿

**ä¸­å¤®ã‚¨ãƒªã‚¢: ã‚¨ãƒ‡ã‚£ã‚¿**
- é¸æŠä¸­ã®è³ªå•ã®ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

**å³ã‚µã‚¤ãƒ‰ãƒãƒ¼: è¨­å®š**
- è¨ºæ–­å…¨ä½“ã®è¨­å®š
- å…¬é–‹è¨­å®š
- åŸ‹ã‚è¾¼ã¿è¨­å®š

**ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½:**
```typescript
// è³ªå•ã®ä¸¦ã³æ›¿ãˆ
onDragEnd = (result) => {
  const newQuestions = reorder(
    questions,
    result.source.index,
    result.destination.index
  );
  setQuestions(newQuestions);
};
```

### FR-ASSESS-4: Assessment Status Management

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»:**
```
ä¸‹æ›¸ã (draft)
   â†“ (å…¬é–‹)
å…¬é–‹ä¸­ (published)
   â†“ (éå…¬é–‹åŒ–)
éå…¬é–‹ (unpublished)
   â†“ (å†å…¬é–‹)
å…¬é–‹ä¸­ (published)
```

**å…¬é–‹å‰ãƒã‚§ãƒƒã‚¯:**
- [ ] æœ€ä½1ã¤ã®è³ªå•ãŒå­˜åœ¨
- [ ] ã™ã¹ã¦ã®è³ªå•ã«å›ç­”é¸æŠè‚¢ãŒã‚ã‚‹ï¼ˆè‡ªç”±è¨˜è¿°ã‚’é™¤ãï¼‰
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

---

## Non-Functional Requirements

### NFR-ASSESS-1: Performance
- è¨ºæ–­ä¸€è¦§ãƒ­ãƒ¼ãƒ‰ < 1ç§’
- ãƒ“ãƒ«ãƒ€ãƒ¼UIæ“ä½œãƒ¬ã‚¹ãƒãƒ³ã‚¹ < 100ms
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¹ãƒ ãƒ¼ã‚º (60fps)
- ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–: 3ç§’ãŠã

### NFR-ASSESS-2: Data Validation
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: Pydanticãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

### NFR-ASSESS-3: Accessibility
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®ã¿ã§è¨ºæ–­ä½œæˆå¯èƒ½
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ
- ARIAå±æ€§é©ç”¨

---

## API Endpoints

### List Assessments
```
GET /api/v1/tenants/{tenant_id}/assessments
Query Parameters:
  - status: string (draft, published, unpublished)
  - category: string
  - search: string
  - page: number (default: 1)
  - limit: number (default: 20)
  - sort_by: string (created_at, updated_at, title)
  - sort_order: string (asc, desc)

Response: {
  "assessments": [
    {
      "id": "uuid",
      "title": "è¨ºæ–­ã‚¿ã‚¤ãƒˆãƒ«",
      "description": "èª¬æ˜",
      "status": "published",
      "category": "marketing",
      "completion_count": 150,
      "created_at": "2025-11-11T10:00:00Z",
      "updated_at": "2025-11-11T12:00:00Z"
    }
  ],
  "total": 50,
  "page": 1,
  "limit": 20
}
```

### Get Assessment Detail
```
GET /api/v1/tenants/{tenant_id}/assessments/{assessment_id}

Response: {
  "id": "uuid",
  "title": "è¨ºæ–­ã‚¿ã‚¤ãƒˆãƒ«",
  "description": "èª¬æ˜",
  "status": "published",
  "category": "marketing",
  "questions": [
    {
      "id": "uuid",
      "order": 1,
      "text": "è³ªå•æ–‡",
      "type": "single_choice",
      "required": true,
      "options": [
        {
          "id": "uuid",
          "text": "é¸æŠè‚¢1",
          "score": 10
        }
      ]
    }
  ],
  "scoring_rules": {...},
  "result_template": {...}
}
```

### Create Assessment
```
POST /api/v1/tenants/{tenant_id}/assessments
Body: {
  "title": "è¨ºæ–­ã‚¿ã‚¤ãƒˆãƒ«",
  "description": "èª¬æ˜",
  "category": "marketing",
  "status": "draft"
}

Response: {
  "id": "uuid",
  "title": "è¨ºæ–­ã‚¿ã‚¤ãƒˆãƒ«",
  ...
}
```

### Update Assessment
```
PUT /api/v1/tenants/{tenant_id}/assessments/{assessment_id}
Body: {
  "title": "æ›´æ–°å¾Œã‚¿ã‚¤ãƒˆãƒ«",
  ...
}

Response: {
  "id": "uuid",
  "title": "æ›´æ–°å¾Œã‚¿ã‚¤ãƒˆãƒ«",
  ...
}
```

### Publish Assessment
```
POST /api/v1/tenants/{tenant_id}/assessments/{assessment_id}/publish

Response: {
  "id": "uuid",
  "status": "published",
  "published_url": "https://diagnoleads.com/a/{short_id}"
}
```

### Unpublish Assessment
```
POST /api/v1/tenants/{tenant_id}/assessments/{assessment_id}/unpublish

Response: {
  "id": "uuid",
  "status": "unpublished"
}
```

### Delete Assessment
```
DELETE /api/v1/tenants/{tenant_id}/assessments/{assessment_id}

Response: 204 No Content
```

---

## UI/UX Design

### Assessment List Page

**Layout:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨ºæ–­ç®¡ç†                    [+ æ–°è¦ä½œæˆ]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æ¤œç´¢]  [ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹â–¼] [ã‚«ãƒ†ã‚´ãƒªâ–¼]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã‚¿ã‚¤ãƒˆãƒ«     â”‚ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ â”‚ å®Œäº†æ•° â”‚ æ›´æ–°æ—¥     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å–¶æ¥­èª²é¡Œè¨ºæ–­ â”‚ ğŸŸ¢ å…¬é–‹ä¸­ â”‚  150  â”‚ 2025-11-10 â”‚
â”‚ ITè¨ºæ–­       â”‚ ğŸ“ ä¸‹æ›¸ã â”‚   0   â”‚ 2025-11-09 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Assessment Builder Page

**Layout:**
```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚è³ªå•â”‚                      â”‚è¨­å®šâ”‚
â”‚ä¸€è¦§â”‚   ã‚¨ãƒ‡ã‚£ã‚¿ã‚¨ãƒªã‚¢      â”‚    â”‚
â”‚    â”‚                      â”‚    â”‚
â”‚Q1  â”‚  è³ªå•æ–‡: [ãƒ†ã‚­ã‚¹ãƒˆ]  â”‚å…¬é–‹â”‚
â”‚Q2  â”‚  ã‚¿ã‚¤ãƒ—: [é¸æŠâ–¼]     â”‚çŠ¶æ…‹â”‚
â”‚Q3  â”‚  é¸æŠè‚¢:            â”‚    â”‚
â”‚    â”‚  â–¡ é¸æŠè‚¢1 (10ç‚¹)   â”‚åŸ‹è¾¼â”‚
â”‚[+] â”‚  â–¡ é¸æŠè‚¢2 (20ç‚¹)   â”‚    â”‚
â”‚    â”‚                      â”‚    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
```

### Question Types UI

**å˜ä¸€é¸æŠ:**
```
è³ªå•: ã‚ãªãŸã®èª²é¡Œã¯ä½•ã§ã™ã‹ï¼Ÿ
â—‹ ãƒªãƒ¼ãƒ‰ç²å¾—ãŒä¸è¶³ (10ç‚¹)
â—‹ å•†è«‡åŒ–ç‡ãŒä½ã„ (20ç‚¹)
â—‹ å–¶æ¥­åŠ¹ç‡ãŒæ‚ªã„ (15ç‚¹)
```

**è¤‡æ•°é¸æŠ:**
```
è³ªå•: åˆ©ç”¨ä¸­ã®ãƒ„ãƒ¼ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰
â˜‘ Salesforce (5ç‚¹)
â˜ HubSpot (5ç‚¹)
â˜‘ Marketo (5ç‚¹)
```

**è‡ªç”±è¨˜è¿°:**
```
è³ªå•: ãã®ä»–ã®èª²é¡ŒãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„
[ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢]
```

**ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼:**
```
è³ªå•: ç¾åœ¨ã®æº€è¶³åº¦ã¯ï¼Ÿ
1 â”â”â”â—â”â”â”â” 10
```

---

## Component Structure

### Pages

```typescript
// frontend/src/pages/assessments/AssessmentsPage.tsx
export function AssessmentsPage() {
  const { tenantId } = useParams();
  const { data: assessments, isLoading } = useAssessments(tenantId);
  
  return (
    <Layout>
      <AssessmentListHeader />
      <AssessmentFilters />
      <AssessmentTable assessments={assessments} />
      <Pagination />
    </Layout>
  );
}

// frontend/src/pages/assessments/CreateAssessmentPage.tsx
export function CreateAssessmentPage() {
  const { tenantId } = useParams();
  const navigate = useNavigate();
  const createMutation = useCreateAssessment();
  
  const handleSubmit = async (data: AssessmentFormData) => {
    await createMutation.mutateAsync(data);
    navigate(`/tenants/${tenantId}/assessments`);
  };
  
  return (
    <Layout>
      <AssessmentForm onSubmit={handleSubmit} />
    </Layout>
  );
}

// frontend/src/pages/assessments/EditAssessmentPage.tsx
export function EditAssessmentPage() {
  const { tenantId, assessmentId } = useParams();
  const { data: assessment } = useAssessment(tenantId, assessmentId);
  
  return (
    <Layout>
      <AssessmentBuilder assessment={assessment} />
    </Layout>
  );
}
```

### Components

```typescript
// frontend/src/components/assessments/AssessmentBuilder.tsx
interface AssessmentBuilderProps {
  assessment: Assessment;
}

export function AssessmentBuilder({ assessment }: AssessmentBuilderProps) {
  const [questions, setQuestions] = useState(assessment.questions);
  const [selectedQuestion, setSelectedQuestion] = useState(null);
  
  return (
    <div className="grid grid-cols-[250px,1fr,300px]">
      <QuestionList
        questions={questions}
        onReorder={setQuestions}
        onSelect={setSelectedQuestion}
      />
      <QuestionEditor
        question={selectedQuestion}
        onChange={handleQuestionChange}
      />
      <SettingsPanel assessment={assessment} />
    </div>
  );
}

// frontend/src/components/assessments/QuestionEditor.tsx
interface QuestionEditorProps {
  question: Question | null;
  onChange: (question: Question) => void;
}

export function QuestionEditor({ question, onChange }: QuestionEditorProps) {
  if (!question) {
    return <EmptyState message="è³ªå•ã‚’é¸æŠã—ã¦ãã ã•ã„" />;
  }
  
  return (
    <div className="p-6">
      <Input
        label="è³ªå•æ–‡"
        value={question.text}
        onChange={(e) => onChange({ ...question, text: e.target.value })}
      />
      <Select
        label="è³ªå•ã‚¿ã‚¤ãƒ—"
        value={question.type}
        onChange={(value) => onChange({ ...question, type: value })}
        options={[
          { label: 'å˜ä¸€é¸æŠ', value: 'single_choice' },
          { label: 'è¤‡æ•°é¸æŠ', value: 'multiple_choice' },
          { label: 'è‡ªç”±è¨˜è¿°', value: 'text' },
          { label: 'ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼', value: 'slider' },
        ]}
      />
      {question.type === 'single_choice' && (
        <OptionsEditor
          options={question.options}
          onChange={(options) => onChange({ ...question, options })}
        />
      )}
    </div>
  );
}
```

---

## State Management

### Assessment Store (Zustand + TanStack Query)

```typescript
// frontend/src/services/assessmentService.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';

export function useAssessments(tenantId: string) {
  return useQuery({
    queryKey: ['assessments', tenantId],
    queryFn: () => assessmentService.list(tenantId),
  });
}

export function useAssessment(tenantId: string, assessmentId: string) {
  return useQuery({
    queryKey: ['assessment', tenantId, assessmentId],
    queryFn: () => assessmentService.get(tenantId, assessmentId),
  });
}

export function useCreateAssessment() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: assessmentService.create,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['assessments'] });
    },
  });
}

export function useUpdateAssessment() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: assessmentService.update,
    onSuccess: (data) => {
      queryClient.setQueryData(['assessment', data.tenant_id, data.id], data);
    },
  });
}

export function usePublishAssessment() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: assessmentService.publish,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['assessments'] });
    },
  });
}
```

---

## Business Logic

### Auto-save Logic
```typescript
// Debounced auto-save every 3 seconds
const debouncedSave = useDebouncedCallback(
  (assessment: Assessment) => {
    updateAssessmentMutation.mutate(assessment);
  },
  3000
);

useEffect(() => {
  if (isDirty) {
    debouncedSave(assessment);
  }
}, [assessment, isDirty]);
```

### Validation Logic
```typescript
// Zod schema
const assessmentSchema = z.object({
  title: z.string().min(1).max(200),
  description: z.string().max(1000).optional(),
  category: z.string().min(1),
  questions: z.array(z.object({
    text: z.string().min(1),
    type: z.enum(['single_choice', 'multiple_choice', 'text', 'slider']),
    required: z.boolean(),
    options: z.array(z.object({
      text: z.string().min(1),
      score: z.number(),
    })).min(2).when('type', {
      is: (val: string) => ['single_choice', 'multiple_choice'].includes(val),
      then: (schema) => schema,
      otherwise: (schema) => schema.optional(),
    }),
  })).min(1),
});

// Validation function
function validateAssessment(assessment: Assessment): ValidationResult {
  try {
    assessmentSchema.parse(assessment);
    return { valid: true, errors: [] };
  } catch (error) {
    return { valid: false, errors: error.errors };
  }
}
```

---

## Testing Strategy

### Unit Tests

**AssessmentBuilder Component:**
- [ ] Renders question list
- [ ] Adds new question
- [ ] Deletes question
- [ ] Reorders questions via drag and drop
- [ ] Updates question on edit

**QuestionEditor Component:**
- [ ] Renders different question types
- [ ] Validates input
- [ ] Shows error messages

**Auto-save Hook:**
- [ ] Debounces correctly
- [ ] Saves after 3 seconds of inactivity
- [ ] Cancels save on unmount

### Integration Tests

**Assessment Creation Flow:**
1. Click "æ–°è¦ä½œæˆ"
2. Fill in form
3. Add questions
4. Save as draft
5. Verify assessment appears in list

**Assessment Publishing:**
1. Edit assessment
2. Click "å…¬é–‹"
3. Verify validation
4. Confirm publish
5. Verify status changed to "published"

### E2E Tests

**Complete Assessment Creation:**
1. Login
2. Navigate to assessments
3. Create new assessment
4. Add 3 questions
5. Configure scoring
6. Publish
7. Verify public URL works

---

## Implementation Notes

### Critical Considerations

**1. Performance:**
- Large assessments (>50 questions) require virtualization
- Debounced auto-save to avoid excessive API calls
- Optimistic updates for better UX

**2. Data Consistency:**
- Conflict resolution for concurrent edits (future: use WebSocket)
- Version history tracking
- Audit log for changes

**3. User Experience:**
- Clear save indicators
- Unsaved changes warning on navigation
- Keyboard shortcuts (Ctrl+S to save, etc.)

**4. Multi-Tenant:**
- ã™ã¹ã¦ã®APIã‚³ãƒ¼ãƒ«ã«tenantIdå«ã‚ã‚‹
- ãƒ†ãƒŠãƒ³ãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿æ¼æ´©ãŒãªã„ã“ã¨ã‚’æ¤œè¨¼

---

## Related Specifications

- [System Core Features](./system-core.md)
- [Lead Management Features](./lead-management-features.md)
- [AI Support](../../specs/features/ai-support.md)
- [Embed Widget](../../specs/features/embed-widget.md)

---

## Changelog

| Date | Version | Changes |
|------|---------|---------|
| 2025-11-11 | 1.0 | Initial specification |

---

**Status**: âœ… Ready for Review  
**Next Steps**: Review â†’ Approve â†’ Implement
