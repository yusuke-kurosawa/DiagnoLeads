# Feature Proposal: Lead Management

**Status**: ğŸ”„ Proposal  
**Created**: 2025-01-10  
**Priority**: High

## Overview

ãƒªãƒ¼ãƒ‰ï¼ˆè¦‹è¾¼ã¿å®¢ï¼‰ã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã€‚å–¶æ¥­æ‹…å½“è€…ã¨ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ‹…å½“è€…ãŒãƒªãƒ¼ãƒ‰ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã—ã€è¨ºæ–­ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚’é€šã˜ã¦é¡§å®¢èª²é¡Œã‚’ç‰¹å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

## User Stories

### Story 1: ãƒªãƒ¼ãƒ‰ç™»éŒ²
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** æ–°ã—ã„ãƒªãƒ¼ãƒ‰ã‚’ç™»éŒ²ã—ãŸã„  
**So that** è¦‹è¾¼ã¿å®¢æƒ…å ±ã‚’ä¸€å…ƒç®¡ç†ã§ãã‚‹

### Story 2: ãƒªãƒ¼ãƒ‰ä¸€è¦§è¡¨ç¤º
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** ãƒªãƒ¼ãƒ‰ã®ä¸€è¦§ã‚’è¡¨ç¤ºã—ãŸã„  
**So that** å…¨ä½“ã®çŠ¶æ³ã‚’æŠŠæ¡ã§ãã‚‹

### Story 3: ãƒªãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** ãƒªãƒ¼ãƒ‰ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ãŸã„  
**So that** é€²æ—ã‚’ç®¡ç†ã§ãã‚‹

### Story 4: ãƒªãƒ¼ãƒ‰ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
**As a** ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ‹…å½“è€…  
**I want to** ãƒªãƒ¼ãƒ‰ã‚’è‡ªå‹•ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã—ãŸã„  
**So that** å„ªå…ˆé †ä½ã‚’ä»˜ã‘ã‚‰ã‚Œã‚‹

### Story 5: ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆçµæœã®è¨˜éŒ²
**As a** ã‚·ã‚¹ãƒ†ãƒ   
**I want to** ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆçµæœã‚’ãƒªãƒ¼ãƒ‰ã«ç´ä»˜ã‘ãŸã„  
**So that** è¨ºæ–­å±¥æ­´ã‚’è¿½è·¡ã§ãã‚‹

## Requirements

### Functional Requirements

#### 1. Lead CRUD
- ãƒªãƒ¼ãƒ‰ã®ä½œæˆï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ã€ä¼šç¤¾åã€å½¹è·ã€é›»è©±ç•ªå·ï¼‰
- ãƒªãƒ¼ãƒ‰ã®ä¸€è¦§è¡¨ç¤ºï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ•ã‚£ãƒ«ã‚¿ã€ã‚½ãƒ¼ãƒˆï¼‰
- ãƒªãƒ¼ãƒ‰ã®è©³ç´°è¡¨ç¤º
- ãƒªãƒ¼ãƒ‰ã®ç·¨é›†
- ãƒªãƒ¼ãƒ‰ã®å‰Šé™¤

#### 2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
- `new` - æ–°è¦ãƒªãƒ¼ãƒ‰ï¼ˆæœªæ¥è§¦ï¼‰
- `contacted` - æ¥è§¦æ¸ˆã¿ï¼ˆãƒ¡ãƒ¼ãƒ«ãƒ»é›»è©±æ¸ˆã¿ï¼‰
- `qualified` - è¦‹è¾¼ã¿ã‚ã‚Šï¼ˆå•†è«‡å¯èƒ½ï¼‰
- `converted` - æˆç´„
- `disqualified` - è¦‹è¾¼ã¿ãªã—

#### 3. ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
- åŸºæœ¬ã‚¹ã‚³ã‚¢: 0-100ç‚¹
- ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯:
  - ãƒ¡ãƒ¼ãƒ«é–‹å°: +10ç‚¹
  - ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯: +20ç‚¹
  - ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆå®Œäº†: +50ç‚¹
  - ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡: +30ç‚¹
- ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°å±¥æ­´ã®è¨˜éŒ²

#### 4. ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆçµæœã¨ã®é€£æº
- ãƒªãƒ¼ãƒ‰ãŒã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚’å®Œäº†ã—ãŸã‚‰è‡ªå‹•è¨˜éŒ²
- ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚¹ã‚³ã‚¢ã‚’ãƒªãƒ¼ãƒ‰ã‚¹ã‚³ã‚¢ã«åæ˜ 
- è¨ºæ–­çµæœã®ä¿å­˜

#### 5. æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- åå‰ã§ã®æ¤œç´¢
- ãƒ¡ãƒ¼ãƒ«ã§ã®æ¤œç´¢
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ã®ãƒ•ã‚£ãƒ«ã‚¿
- ã‚¹ã‚³ã‚¢ç¯„å›²ã§ã®ãƒ•ã‚£ãƒ«ã‚¿
- ä½œæˆæ—¥æ™‚ã§ã®ã‚½ãƒ¼ãƒˆ

#### 6. ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ
- ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«å®Œå…¨åˆ†é›¢
- ãƒ†ãƒŠãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢
- CASCADE DELETEï¼ˆãƒ†ãƒŠãƒ³ãƒˆå‰Šé™¤æ™‚ï¼‰

### Non-Functional Requirements

- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: 
  - ä¸€è¦§å–å¾—: 100msä»¥å†…
  - æ¤œç´¢: 200msä»¥å†…
  - 10,000ãƒªãƒ¼ãƒ‰/ãƒ†ãƒŠãƒ³ãƒˆã¾ã§å¯¾å¿œ

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**:
  - ã™ã¹ã¦ã®ã‚¯ã‚¨ãƒªã§tenant_idãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¿…é ˆ
  - PIIï¼ˆå€‹äººæƒ…å ±ï¼‰ã®é©åˆ‡ãªå–ã‚Šæ‰±ã„
  - ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²

- **å¯ç”¨æ€§**: 99.9%ä»¥ä¸Š

- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: 
  - 1,000ãƒ†ãƒŠãƒ³ãƒˆåŒæ™‚åˆ©ç”¨
  - 10,000ãƒªãƒ¼ãƒ‰/ãƒ†ãƒŠãƒ³ãƒˆ

## Data Model

### Lead Entity

```python
class Lead(Base):
    """Lead model with tenant association"""
    
    __tablename__ = "leads"
    
    # Primary Key
    id: UUID                        # ä¸€æ„è­˜åˆ¥å­
    
    # Foreign Keys
    tenant_id: UUID                 # ãƒ†ãƒŠãƒ³ãƒˆIDï¼ˆå¿…é ˆã€CASCADE DELETEï¼‰
    created_by: UUID                # ä½œæˆè€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
    updated_by: UUID | None         # æ›´æ–°è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
    assigned_to: UUID | None        # æ‹…å½“è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
    
    # Core Fields
    name: str                       # æ°åï¼ˆå¿…é ˆã€æœ€å¤§255æ–‡å­—ï¼‰
    email: str                      # ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå¿…é ˆã€unique per tenantï¼‰
    company: str | None             # ä¼šç¤¾åï¼ˆæœ€å¤§255æ–‡å­—ï¼‰
    job_title: str | None           # å½¹è·ï¼ˆæœ€å¤§100æ–‡å­—ï¼‰
    phone: str | None               # é›»è©±ç•ªå·ï¼ˆæœ€å¤§20æ–‡å­—ï¼‰
    
    # Status & Score
    status: str                     # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (new/contacted/qualified/converted/disqualified)
    score: int                      # ã‚¹ã‚³ã‚¢ï¼ˆ0-100ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0ï¼‰
    
    # Engagement Tracking
    last_contacted_at: DateTime | None   # æœ€çµ‚æ¥è§¦æ—¥æ™‚
    last_activity_at: DateTime | None    # æœ€çµ‚æ´»å‹•æ—¥æ™‚
    
    # Additional Info
    notes: Text | None              # ãƒ¡ãƒ¢
    tags: JSON                      # ã‚¿ã‚°ï¼ˆé…åˆ—ï¼‰
    custom_fields: JSON             # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    
    # Timestamps
    created_at: DateTime            # ä½œæˆæ—¥æ™‚
    updated_at: DateTime            # æ›´æ–°æ—¥æ™‚
    
    # Indexes
    Index('idx_leads_tenant_status', tenant_id, status)
    Index('idx_leads_tenant_score', tenant_id, score)
    Index('idx_leads_email', tenant_id, email)  # Unique constraint
    Index('idx_leads_assigned_to', assigned_to)
```

### Validation Rules

- `name`: å¿…é ˆã€1-255æ–‡å­—
- `email`: å¿…é ˆã€emailå½¢å¼ã€ãƒ†ãƒŠãƒ³ãƒˆå†…ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯
- `company`: ä»»æ„ã€æœ€å¤§255æ–‡å­—
- `job_title`: ä»»æ„ã€æœ€å¤§100æ–‡å­—
- `phone`: ä»»æ„ã€æœ€å¤§20æ–‡å­—ã€é›»è©±ç•ªå·å½¢å¼
- `status`: `new` | `contacted` | `qualified` | `converted` | `disqualified`
- `score`: 0-100ã®æ•´æ•°
- `tenant_id`: å¿…é ˆã€å­˜åœ¨ã™ã‚‹ãƒ†ãƒŠãƒ³ãƒˆ
- `created_by`: å¿…é ˆã€å­˜åœ¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼

### Relationships

```
Lead (å¤š) â†â†’ (1) Tenant
Lead (å¤š) â†â†’ (1) User (created_by)
Lead (å¤š) â†â†’ (1) User (assigned_to)
Lead (å¤š) â†â†’ (å¤š) Assessment (through AssessmentResult)
```

## API Design (æ¦‚è¦)

### Endpoints

```
POST   /api/v1/tenants/{tenant_id}/leads
GET    /api/v1/tenants/{tenant_id}/leads
GET    /api/v1/tenants/{tenant_id}/leads/search?q={query}
GET    /api/v1/tenants/{tenant_id}/leads/{lead_id}
PUT    /api/v1/tenants/{tenant_id}/leads/{lead_id}
DELETE /api/v1/tenants/{tenant_id}/leads/{lead_id}
PATCH  /api/v1/tenants/{tenant_id}/leads/{lead_id}/status
PATCH  /api/v1/tenants/{tenant_id}/leads/{lead_id}/score
```

### Request/Response Examples

#### Create Lead (POST)

**Request:**
```json
{
  "name": "Tanaka Taro",
  "email": "tanaka@example.com",
  "company": "Example Corp",
  "job_title": "Marketing Manager",
  "phone": "+81-90-1234-5678",
  "status": "new",
  "tags": ["enterprise", "marketing"],
  "notes": "Met at tech conference"
}
```

**Response (201):**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "tenant_id": "660e8400-e29b-41d4-a716-446655440000",
  "name": "Tanaka Taro",
  "email": "tanaka@example.com",
  "company": "Example Corp",
  "job_title": "Marketing Manager",
  "phone": "+81-90-1234-5678",
  "status": "new",
  "score": 0,
  "tags": ["enterprise", "marketing"],
  "notes": "Met at tech conference",
  "created_by": "770e8400-e29b-41d4-a716-446655440000",
  "created_at": "2025-01-10T10:30:00Z",
  "updated_at": "2025-01-10T10:30:00Z"
}
```

### Security

ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ï¼š
- âœ… JWTèªè¨¼å¿…é ˆ
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®tenant_idã¨ãƒ‘ã‚¹ã®tenant_idã®ä¸€è‡´ã‚’æ¤œè¨¼
- âœ… ä¸ä¸€è‡´ã®å ´åˆã¯403 Forbidden
- âœ… å­˜åœ¨ã—ãªã„ãƒªã‚½ãƒ¼ã‚¹ã¯404 Not Found
- âœ… ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆåŒä¸€ãƒ†ãƒŠãƒ³ãƒˆå†…ï¼‰

## UI/UX Design

### Components

#### 1. LeadList
- **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**: ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼‰ã€ã‚«ãƒ¼ãƒ‰å½¢å¼ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰
- **è¡¨ç¤ºé …ç›®**: 
  - åå‰
  - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  - ä¼šç¤¾å
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
  - ã‚¹ã‚³ã‚¢ï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼‰
  - æœ€çµ‚æ¥è§¦æ—¥
- **æ©Ÿèƒ½**:
  - ã‚½ãƒ¼ãƒˆï¼ˆåå‰ã€ã‚¹ã‚³ã‚¢ã€ä½œæˆæ—¥æ™‚ï¼‰
  - ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ã‚¹ã‚³ã‚¢ç¯„å›²ï¼‰
  - æ¤œç´¢ï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ï¼‰
  - ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
  - "Create Lead" ãƒœã‚¿ãƒ³
  - ä¸€æ‹¬æ“ä½œï¼ˆé¸æŠã€å‰Šé™¤ï¼‰

#### 2. LeadForm (create/editå…±é€š)
- **åŸºæœ¬æƒ…å ±**:
  - åå‰ï¼ˆå¿…é ˆï¼‰
  - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå¿…é ˆã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
  - ä¼šç¤¾åï¼ˆä»»æ„ï¼‰
  - å½¹è·ï¼ˆä»»æ„ï¼‰
  - é›»è©±ç•ªå·ï¼ˆä»»æ„ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠ
- **ã‚¿ã‚°**: ãƒãƒ«ãƒã‚»ãƒ¬ã‚¯ãƒˆ
- **ãƒ¡ãƒ¢**: ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- **ãƒœã‚¿ãƒ³**: Cancel / Save

#### 3. LeadDetailPage
- **ãƒ˜ãƒƒãƒ€ãƒ¼**:
  - åå‰ã€ä¼šç¤¾å
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
  - ã‚¹ã‚³ã‚¢è¡¨ç¤ºï¼ˆå††ã‚°ãƒ©ãƒ•ï¼‰
  - Edit / Delete / Assign ãƒœã‚¿ãƒ³
- **ã‚¿ãƒ–**:
  - Overview: åŸºæœ¬æƒ…å ±ã€é€£çµ¡å…ˆ
  - Activity: æ´»å‹•å±¥æ­´ï¼ˆæ¥è§¦è¨˜éŒ²ï¼‰
  - Assessments: å®Œäº†ã—ãŸè¨ºæ–­ä¸€è¦§
  - Notes: ãƒ¡ãƒ¢ä¸€è¦§
- **ã‚µã‚¤ãƒ‰ãƒãƒ¼**:
  - æ‹…å½“è€…æƒ…å ±
  - ã‚¿ã‚°
  - ä½œæˆãƒ»æ›´æ–°æ—¥æ™‚

#### 4. LeadStatusBadge
- `new`: é’è‰²ãƒãƒƒã‚¸
- `contacted`: é»„è‰²ãƒãƒƒã‚¸
- `qualified`: ç·‘è‰²ãƒãƒƒã‚¸
- `converted`: ç´«è‰²ãƒãƒƒã‚¸ï¼ˆæˆç´„ï¼‰
- `disqualified`: ç°è‰²ãƒãƒƒã‚¸

### User Flow

```
[LeadList]
    â†“ "Create Lead"
[CreateLeadPage]
    â†“ ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    â†“ "Save"
[LeadDetailPage] â† æ–°è¦ä½œæˆå®Œäº†
    â†“ "Edit"
[EditLeadPage]
    â†“ ç·¨é›†
    â†“ "Save"
[LeadDetailPage] â† æ›´æ–°å®Œäº†
    â†“ "Send Assessment"
[AssessmentSelectionDialog]
    â†“ ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé¸æŠ
[AssessmentSent] â† ãƒªãƒ¼ãƒ‰ã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡
```

## Business Logic

### 1. ãƒªãƒ¼ãƒ‰ä½œæˆ
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ç¢ºèª
2. ãƒ†ãƒŠãƒ³ãƒˆæ¨©é™ç¢ºèª
3. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
   - ãƒ¡ãƒ¼ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
   - åŒä¸€ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ¡ãƒ¼ãƒ«é‡è¤‡ãƒã‚§ãƒƒã‚¯
4. tenant_idã€created_by ã‚’è‡ªå‹•è¨­å®š
5. score ã‚’ 0 ã«åˆæœŸåŒ–
6. status ã‚’ 'new' ã«è¨­å®š
7. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
8. 201 Created ã§å¿œç­”
```

### 2. ãƒªãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ç¢ºèª
2. ãƒ†ãƒŠãƒ³ãƒˆæ¨©é™ç¢ºèª
3. ãƒªã‚½ãƒ¼ã‚¹ã®å­˜åœ¨ç¢ºèª
4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
   - new â†’ contacted âœ…
   - contacted â†’ qualified âœ…
   - qualified â†’ converted âœ…
   - qualified â†’ disqualified âœ…
   - converted â†’ * âŒ (ä¸€åº¦æˆç´„ã—ãŸã‚‰å¤‰æ›´ä¸å¯)
5. last_activity_at ã‚’ç¾åœ¨æ™‚åˆ»ã«æ›´æ–°
6. updated_by ã‚’ç¾åœ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¨­å®š
7. æ›´æ–°å®Ÿè¡Œ
8. 200 OK ã§å¿œç­”
```

### 3. ã‚¹ã‚³ã‚¢è¨ˆç®—
```
åˆæœŸã‚¹ã‚³ã‚¢: 0

ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ¥åŠ ç‚¹:
- ãƒ¡ãƒ¼ãƒ«é–‹å°: +10
- ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯: +20
- ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹: +30
- ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆå®Œäº†: +50
- ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡: +30
- Webã‚µã‚¤ãƒˆè¨ªå•: +5

æœ€å¤§ã‚¹ã‚³ã‚¢: 100

ã‚¹ã‚³ã‚¢ç¯„å›²åˆ¥åˆ†é¡:
- 0-30: Cold Leadï¼ˆä½å„ªå…ˆåº¦ï¼‰
- 31-60: Warm Leadï¼ˆä¸­å„ªå…ˆåº¦ï¼‰
- 61-100: Hot Leadï¼ˆé«˜å„ªå…ˆåº¦ï¼‰
```

### 4. ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢
```python
# ã™ã¹ã¦ã®ã‚¯ã‚¨ãƒªã§å¿…é ˆ
def get_leads(tenant_id: UUID, current_user: User):
    # 1. ãƒ†ãƒŠãƒ³ãƒˆæ¨©é™ç¢ºèª
    if current_user.tenant_id != tenant_id:
        raise HTTPException(403, "Access forbidden")
    
    # 2. ã‚¯ã‚¨ãƒªã«tenant_idãƒ•ã‚£ãƒ«ã‚¿
    leads = db.query(Lead).filter(
        Lead.tenant_id == tenant_id
    ).all()
    
    return leads
```

## Testing Strategy

### Unit Tests (Backend)
- `test_create_lead` - ãƒªãƒ¼ãƒ‰ä½œæˆ
- `test_create_lead_duplicate_email` - ãƒ¡ãƒ¼ãƒ«é‡è¤‡ã‚¨ãƒ©ãƒ¼
- `test_list_leads` - ãƒªãƒ¼ãƒ‰ä¸€è¦§
- `test_list_leads_with_filters` - ãƒ•ã‚£ãƒ«ã‚¿ä»˜ãä¸€è¦§
- `test_get_lead` - ãƒªãƒ¼ãƒ‰å–å¾—
- `test_update_lead` - ãƒªãƒ¼ãƒ‰æ›´æ–°
- `test_update_lead_status` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
- `test_update_lead_score` - ã‚¹ã‚³ã‚¢æ›´æ–°
- `test_delete_lead` - ãƒªãƒ¼ãƒ‰å‰Šé™¤
- `test_search_leads` - ãƒªãƒ¼ãƒ‰æ¤œç´¢
- `test_cross_tenant_access_denied` - **ã‚¯ãƒ­ã‚¹ãƒ†ãƒŠãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ï¼ˆé‡è¦ï¼‰**
- `test_lead_email_unique_per_tenant` - ãƒ†ãƒŠãƒ³ãƒˆå†…ãƒ¡ãƒ¼ãƒ«ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„
- `test_invalid_status_transition` - ä¸æ­£ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ã‚¨ãƒ©ãƒ¼

### Integration Tests
- ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ã®æ¤œè¨¼
- CASCADE DELETEã®å‹•ä½œç¢ºèª
- ã‚¹ã‚³ã‚¢è¨ˆç®—ã®æ­£ç¢ºæ€§
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ãƒ­ã‚¸ãƒƒã‚¯

### Frontend Tests
- LeadListã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- LeadFormãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°UI
- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½

## Implementation Plan

### Phase 1: Backend (2-3 hours)
1. Modelä½œæˆ (`backend/app/models/lead.py`)
2. Schemaä½œæˆ (`backend/app/schemas/lead.py`)
3. Serviceä½œæˆ (`backend/app/services/lead_service.py`)
4. API endpointsä½œæˆ (`backend/app/api/v1/leads.py`)
5. Migrationä½œæˆãƒ»é©ç”¨
6. Testsä½œæˆ (`backend/tests/test_lead.py`)

### Phase 2: OpenAPI & Types (30 min)
1. OpenAPIä»•æ§˜ç”Ÿæˆ (`python scripts/generate_openapi.py`)
2. TypeScriptå‹ç”Ÿæˆ (`npm run generate:types`)
3. å‹ãƒã‚§ãƒƒã‚¯ãƒ»æ¤œè¨¼

### Phase 3: Frontend (3-4 hours)
1. API Serviceä½œæˆ (`frontend/src/services/leadService.ts`)
2. Componentsä½œæˆ:
   - `LeadList.tsx`
   - `LeadForm.tsx`
   - `LeadStatusBadge.tsx`
3. Pagesä½œæˆ:
   - `LeadsPage.tsx`
   - `CreateLeadPage.tsx`
   - `EditLeadPage.tsx`
   - `LeadDetailPage.tsx`

### Phase 4: Testing & Verification (1 hour)
1. Backend testså®Ÿè¡Œãƒ»ä¿®æ­£
2. Frontend buildãƒ»lint
3. E2Eãƒ†ã‚¹ãƒˆï¼ˆæ‰‹å‹•ï¼‰

## Related Features

### ä»Šå¾Œã®æ‹¡å¼µ
- [ ] ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ï¼ˆã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã¸ã®æ‹›å¾…ï¼‰
- [ ] æ´»å‹•å±¥æ­´ã®è¨˜éŒ²ï¼ˆActivity Logï¼‰
- [ ] Salesforce/HubSpotçµ±åˆ
- [ ] ãƒªãƒ¼ãƒ‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆCSVï¼‰
- [ ] ãƒªãƒ¼ãƒ‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- [ ] ãƒªãƒ¼ãƒ‰ã®é‡è¤‡æ¤œå‡ºãƒ»ãƒãƒ¼ã‚¸
- [ ] ãƒªãƒ¼ãƒ‰ã‚¹ã‚³ã‚¢ã®è‡ªå‹•æ›´æ–°ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–ï¼‰

### ä¾å­˜ã™ã‚‹æ©Ÿèƒ½
- âœ… Assessment CRUDï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- [ ] Assessment Resultï¼ˆæœªå®Ÿè£…ï¼‰
- [ ] Email Serviceï¼ˆæœªå®Ÿè£…ï¼‰
- [ ] Activity Logï¼ˆæœªå®Ÿè£…ï¼‰

## Open Questions

1. **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡**: ç•°ãªã‚‹ãƒ†ãƒŠãƒ³ãƒˆé–“ã§åŒã˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨±å¯ã™ã‚‹ã‹ï¼Ÿ
   - **ææ¡ˆ**: è¨±å¯ã™ã‚‹ï¼ˆãƒ†ãƒŠãƒ³ãƒˆå†…ã§ã®ã¿ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼‰

2. **å‰Šé™¤æ–¹æ³•**: ç‰©ç†å‰Šé™¤ vs è«–ç†å‰Šé™¤ï¼Ÿ
   - **ææ¡ˆ**: ç‰©ç†å‰Šé™¤ï¼ˆGDPRã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ï¼‰

3. **ã‚¹ã‚³ã‚¢ã®æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  vs ãƒãƒƒãƒå‡¦ç†ï¼Ÿ
   - **ææ¡ˆ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ï¼‰

4. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»åˆ¶é™**: å³å¯†ã«åˆ¶å¾¡ã™ã‚‹ã‹ï¼Ÿ
   - **ææ¡ˆ**: æ¨å¥¨ãƒ•ãƒ­ãƒ¼ã‚’ç¤ºã™ãŒã€è‡ªç”±ã«å¤‰æ›´å¯èƒ½

## Acceptance Criteria

- [ ] ãƒªãƒ¼ãƒ‰ã®CRUDæ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒ†ãƒŠãƒ³ãƒˆé–“ã®å®Œå…¨ãªåˆ†é›¢ãŒä¿è¨¼ã•ã‚Œã‚‹
- [ ] ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãƒ†ãƒŠãƒ³ãƒˆå†…ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [ ] ã‚¹ã‚³ã‚¢ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹
- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ï¼ˆç›®æ¨™: 100%ï¼‰
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰UIãŒä½¿ã„ã‚„ã™ã„
- [ ] OpenAPIä»•æ§˜ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
- [ ] TypeScriptå‹ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã‚‹

## Risks & Mitigation

### Risk 1: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ
- **ãƒªã‚¹ã‚¯**: å¤§é‡ãƒªãƒ¼ãƒ‰ï¼ˆ10,000+ï¼‰ã§ã®ä¸€è¦§è¡¨ç¤ºãŒé…ã„
- **å¯¾ç­–**: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ã€ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

### Risk 2: ãƒ¡ãƒ¼ãƒ«é‡è¤‡å‡¦ç†
- **ãƒªã‚¹ã‚¯**: è¤‡é›‘ãªé‡è¤‡ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯
- **å¯¾ç­–**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã€æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### Risk 3: ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã®è¤‡é›‘åŒ–
- **ãƒªã‚¹ã‚¯**: å°†æ¥çš„ã«ã‚¹ã‚³ã‚¢è¨ˆç®—ãŒè¤‡é›‘ã«ãªã‚‹
- **å¯¾ç­–**: æ‹¡å¼µå¯èƒ½ãªè¨­è¨ˆã€JSONè¨­å®šã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åŒ–

## Timeline

- **Phase 1 (Backend)**: 2-3 hours
- **Phase 2 (OpenAPI/Types)**: 30 min
- **Phase 3 (Frontend)**: 3-4 hours
- **Phase 4 (Testing)**: 1 hour

**Total**: 6-8 hours

---

**Next Steps**:
1. ãƒãƒ¼ãƒ ãƒ¬ãƒ“ãƒ¥ãƒ¼
2. æ‰¿èªå¾Œã€`openspec/specs/features/lead-management.md`ã«ç§»å‹•
3. å®Ÿè£…é–‹å§‹

**Reviewers**: @team  
**Estimated Effort**: 6-8 hours  
**Priority**: High
