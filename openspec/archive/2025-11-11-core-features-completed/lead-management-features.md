# Feature Specification: Lead Management Features

**Version**: 1.0  
**Status**: Proposal  
**Last Updated**: 2025-11-11  
**Related Proposal**: [core-features-proposal.md](./core-features-proposal.md)

---

## Overview

DiagnoLeadsã®ãƒªãƒ¼ãƒ‰ç®¡ç†æ©Ÿèƒ½ã®å®Œå…¨ãªä»•æ§˜ã‚’å®šç¾©ã—ã¾ã™ã€‚ãƒªãƒ¼ãƒ‰ã®ä¸€è¦§è¡¨ç¤ºã€è©³ç´°è¡¨ç¤ºã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ã€ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã€Microsoft Teamsé€šçŸ¥é€£æºã‚’å«ã¿ã¾ã™ã€‚

---

## User Stories

### US-LEAD-1: ãƒªãƒ¼ãƒ‰ä¸€è¦§è¡¨ç¤º
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** ç²å¾—ã—ãŸãƒªãƒ¼ãƒ‰ã®ä¸€è¦§ã‚’è¦‹ãŸã„  
**So that** ã©ã®ãƒªãƒ¼ãƒ‰ã«ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã™ã¹ãã‹åˆ¤æ–­ã§ãã‚‹

**Acceptance Criteria:**
- [ ] ãƒªãƒ¼ãƒ‰ä¸€è¦§ãŒãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] å„ãƒªãƒ¼ãƒ‰ã«ä»¥ä¸‹ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹: åå‰ã€ä¼šç¤¾ã€ã‚¹ã‚³ã‚¢ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ç²å¾—æ—¥
- [ ] ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆå¯èƒ½
- [ ] ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ï¼ˆã‚¹ã‚³ã‚¢ >= 80ï¼‰ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º

### US-LEAD-2: ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰å„ªå…ˆè¡¨ç¤º
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ï¼ˆé«˜ã‚¹ã‚³ã‚¢ï¼‰ã‚’å„ªå…ˆçš„ã«ç¢ºèªã—ãŸã„  
**So that** æœ€ã‚‚è¦‹è¾¼ã¿ã®é«˜ã„ãƒªãƒ¼ãƒ‰ã«ç´ æ—©ãã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ãã‚‹

**Acceptance Criteria:**
- [ ] ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã‚¹ã‚³ã‚¢ >= 80ï¼‰
- [ ] ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ãƒãƒƒã‚¸è¡¨ç¤ºï¼ˆğŸ”¥ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- [ ] ã‚¹ã‚³ã‚¢é™é †ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ãƒˆ

### US-LEAD-3: ãƒªãƒ¼ãƒ‰è©³ç´°è¡¨ç¤º
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** ãƒªãƒ¼ãƒ‰ã®è©³ç´°æƒ…å ±ã‚’ç¢ºèªã—ãŸã„  
**So that** é©åˆ‡ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ–¹æ³•ã‚’æ±ºå®šã§ãã‚‹

**Acceptance Criteria:**
- [ ] ãƒªãƒ¼ãƒ‰ã®åŸºæœ¬æƒ…å ±ï¼ˆåå‰ã€ä¼šç¤¾ã€å½¹è·ã€é€£çµ¡å…ˆï¼‰
- [ ] è¨ºæ–­çµæœï¼ˆå®Œäº†ã—ãŸè¨ºæ–­ã€å›ç­”å†…å®¹ï¼‰
- [ ] ã‚¹ã‚³ã‚¢è©³ç´°ï¼ˆã‚¹ã‚³ã‚¢ã®å†…è¨³ï¼‰
- [ ] ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å±¥æ­´ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã€ãƒ¡ãƒ¢è¿½åŠ ï¼‰
- [ ] é–¢é€£ã™ã‚‹è¨ºæ–­ã¸ã®å‚ç…§

### US-LEAD-4: ãƒªãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** ãƒªãƒ¼ãƒ‰ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»æ¤œç´¢ã—ãŸã„  
**So that** ç‰¹å®šã®æ¡ä»¶ã«åˆã†ãƒªãƒ¼ãƒ‰ã‚’ç´ æ—©ãè¦‹ã¤ã‘ã‚‰ã‚Œã‚‹

**Acceptance Criteria:**
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆæ–°è¦ã€ã‚³ãƒ³ã‚¿ã‚¯ãƒˆæ¸ˆã¿ã€å•†è«‡ä¸­ã€æˆç´„ã€å¤±æ³¨ï¼‰
- [ ] ã‚¹ã‚³ã‚¢ç¯„å›²ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆä¾‹: 80-100ï¼‰
- [ ] æ—¥ä»˜ç¯„å›²ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆç²å¾—æ—¥ã€æœ€çµ‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£æ—¥ï¼‰
- [ ] è¨ºæ–­åˆ¥ãƒ•ã‚£ãƒ«ã‚¿
- [ ] ä¼šç¤¾åãƒ»åå‰ã®æ¤œç´¢

### US-LEAD-5: ãƒªãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** ãƒªãƒ¼ãƒ‰ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ãŸã„  
**So that** å–¶æ¥­ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç®¡ç†ã§ãã‚‹

**Acceptance Criteria:**
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´å±¥æ­´ã®è¨˜éŒ²
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´æ™‚ã®ãƒ¡ãƒ¢å…¥åŠ›ï¼ˆä»»æ„ï¼‰

### US-LEAD-6: ãƒªãƒ¼ãƒ‰æ‰‹å‹•ä½œæˆ
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** è¨ºæ–­ã¨ã¯åˆ¥ã«æ‰‹å‹•ã§ãƒªãƒ¼ãƒ‰ã‚’ä½œæˆã—ãŸã„  
**So that** ã‚¤ãƒ™ãƒ³ãƒˆç­‰ã§ç²å¾—ã—ãŸååˆºæƒ…å ±ã‚’ç®¡ç†ã§ãã‚‹

**Acceptance Criteria:**
- [ ] ãƒªãƒ¼ãƒ‰ä½œæˆãƒ•ã‚©ãƒ¼ãƒ 
- [ ] å¿…é ˆé …ç›®: åå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- [ ] ä»»æ„é …ç›®: ä¼šç¤¾ã€å½¹è·ã€é›»è©±ç•ªå·ã€ã‚¹ã‚³ã‚¢
- [ ] ä½œæˆå¾Œã€ãƒªãƒ¼ãƒ‰ä¸€è¦§ã«è¡¨ç¤º

### US-LEAD-7: Teamsé€šçŸ¥
**As a** å–¶æ¥­æ‹…å½“è€…  
**I want to** ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ãŒç™ºç”Ÿã—ãŸã‚‰Microsoft Teamsã§é€šçŸ¥ã‚’å—ã‘ãŸã„  
**So that** å³åº§ã«ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã§ãã‚‹

**Acceptance Criteria:**
- [ ] ã‚¹ã‚³ã‚¢ >= 80ã®ãƒªãƒ¼ãƒ‰ä½œæˆæ™‚ã«è‡ªå‹•é€šçŸ¥
- [ ] ã‚¹ã‚³ã‚¢æ›´æ–°ã§é–¾å€¤ã‚’è¶…ãˆãŸæ™‚ã«é€šçŸ¥
- [ ] é€šçŸ¥ã«ãƒªãƒ¼ãƒ‰è©³ç´°ï¼ˆåå‰ã€ä¼šç¤¾ã€ã‚¹ã‚³ã‚¢ï¼‰ã‚’å«ã‚€
- [ ] ãƒªãƒ¼ãƒ‰è©³ç´°ãƒšãƒ¼ã‚¸ã¸ã®ç›´ãƒªãƒ³ã‚¯

---

## Functional Requirements

### FR-LEAD-1: Lead List Page

**è¡¨ç¤ºå†…å®¹:**
| ã‚«ãƒ©ãƒ  | èª¬æ˜ | ã‚½ãƒ¼ãƒˆå¯å¦ | ãƒ•ã‚£ãƒ«ã‚¿å¯å¦ |
|--------|------|-----------|-------------|
| ğŸ”¥ | ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ | - | âœ… |
| åå‰ | ãƒªãƒ¼ãƒ‰å | âœ… | - |
| ä¼šç¤¾ | ä¼šç¤¾å | âœ… | - |
| ã‚¹ã‚³ã‚¢ | 0-100 | âœ… | âœ… |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å–¶æ¥­ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | âœ… | âœ… |
| è¨ºæ–­ | å®Œäº†ã—ãŸè¨ºæ–­å | âœ… | âœ… |
| ç²å¾—æ—¥ | ãƒªãƒ¼ãƒ‰ç²å¾—æ—¥æ™‚ | âœ… | âœ… |
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | è©³ç´°/ç·¨é›†/å‰Šé™¤ | - | - |

**ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°:**
```typescript
interface LeadFilters {
  status?: LeadStatus[];          // ['new', 'contacted', ...]
  score_min?: number;             // 0-100
  score_max?: number;             // 0-100
  is_hot?: boolean;               // ã‚¹ã‚³ã‚¢ >= 80
  assessment_id?: string;         // è¨ºæ–­IDã§ãƒ•ã‚£ãƒ«ã‚¿
  created_after?: string;         // ISO 8601
  created_before?: string;        // ISO 8601
  search?: string;                // åå‰ãƒ»ä¼šç¤¾åã®æ¤œç´¢
}
```

**ã‚½ãƒ¼ãƒˆ:**
```typescript
interface LeadSort {
  sort_by: 'score' | 'created_at' | 'name' | 'company' | 'status';
  sort_order: 'asc' | 'desc';
}
```

**ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³:**
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20ä»¶/ãƒšãƒ¼ã‚¸
- ã‚ªãƒ—ã‚·ãƒ§ãƒ³: 10, 20, 50, 100ä»¶

### FR-LEAD-2: Lead Detail Page

**è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³:**

**1. åŸºæœ¬æƒ…å ±ã‚«ãƒ¼ãƒ‰**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”¥ ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰                     â”‚
â”‚  ãƒ†ã‚¹ãƒˆå¤ªéƒ                          â”‚
â”‚  ãƒ†ã‚¹ãƒˆæ ªå¼ä¼šç¤¾ - ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°éƒ¨é•·  â”‚
â”‚  ğŸ“§ test@example.com                â”‚
â”‚  ğŸ“ 03-1234-5678                    â”‚
â”‚  ğŸ“Š ã‚¹ã‚³ã‚¢: 95/100                  â”‚
â”‚  ğŸ“… ç²å¾—æ—¥: 2025-11-10 14:30       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: [æ–°è¦ â–¼]         â”‚
â”‚  æ‹…å½“è€…: [æœªå‰²å½“ â–¼]                 â”‚
â”‚  [ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**3. è¨ºæ–­çµæœ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®Œäº†ã—ãŸè¨ºæ–­                        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  ğŸ“‹ å–¶æ¥­èª²é¡Œè¨ºæ–­                    â”‚
â”‚     å®Œäº†æ—¥: 2025-11-10 14:25       â”‚
â”‚     ã‚¹ã‚³ã‚¢: 95/100                 â”‚
â”‚     [è©³ç´°ã‚’è¦‹ã‚‹]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**4. ã‚¹ã‚³ã‚¢å†…è¨³**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚¹ã‚³ã‚¢å†…è¨³                          â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  è³ªå•1: ã‚ãªãŸã®èª²é¡Œã¯ï¼Ÿ             â”‚
â”‚  å›ç­”: ãƒªãƒ¼ãƒ‰ç²å¾—ãŒä¸è¶³              â”‚
â”‚  é…ç‚¹: 20/25                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  è³ªå•2: åˆ©ç”¨ä¸­ã®ãƒ„ãƒ¼ãƒ«ã¯ï¼Ÿ           â”‚
â”‚  å›ç­”: Salesforce, HubSpot          â”‚
â”‚  é…ç‚¹: 15/20                        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  åˆè¨ˆ: 95/100                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**5. ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å±¥æ­´**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å±¥æ­´                  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  â° 2025-11-11 10:00               â”‚
â”‚  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´: æ–°è¦ â†’ ã‚³ãƒ³ã‚¿ã‚¯ãƒˆæ¸ˆã¿ â”‚
â”‚  by å–¶æ¥­å¤ªéƒ                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â° 2025-11-10 14:30               â”‚
â”‚  ãƒªãƒ¼ãƒ‰ç²å¾—ï¼ˆè¨ºæ–­å®Œäº†ï¼‰              â”‚
â”‚  è¨ºæ–­: å–¶æ¥­èª²é¡Œè¨ºæ–­                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**6. ãƒ¡ãƒ¢**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ¡ãƒ¢                    [+ è¿½åŠ ]    â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  ğŸ“ 2025-11-11 10:15               â”‚
â”‚  é›»è©±ã§ã‚³ãƒ³ã‚¿ã‚¯ãƒˆã€‚æ¥é€±é¢è«‡äºˆå®šã€‚    â”‚
â”‚  by å–¶æ¥­å¤ªéƒ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### FR-LEAD-3: Lead Status Workflow

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šç¾©:**
```typescript
enum LeadStatus {
  NEW = 'new',                  // æ–°è¦ï¼ˆæœªå¯¾å¿œï¼‰
  CONTACTED = 'contacted',      // ã‚³ãƒ³ã‚¿ã‚¯ãƒˆæ¸ˆã¿
  QUALIFIED = 'qualified',      // æœ‰æœ›ï¼ˆå•†è«‡åŒ–ï¼‰
  NEGOTIATION = 'negotiation',  // å•†è«‡ä¸­
  WON = 'won',                  // æˆç´„
  LOST = 'lost',                // å¤±æ³¨
}
```

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ãƒ«ãƒ¼ãƒ«:**
```
æ–°è¦ (new)
  â†“
ã‚³ãƒ³ã‚¿ã‚¯ãƒˆæ¸ˆã¿ (contacted)
  â†“
æœ‰æœ› (qualified)
  â†“
å•†è«‡ä¸­ (negotiation)
  â†“ â†˜
æˆç´„ (won)  å¤±æ³¨ (lost)
```

**è‡ªå‹•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°:**
- ãƒªãƒ¼ãƒ‰ç²å¾—æ™‚: è‡ªå‹•çš„ã« `NEW` ã«è¨­å®š
- ã‚¹ã‚³ã‚¢ãŒ80ã‚’è¶…ãˆãŸæ™‚: `QUALIFIED` ã«è‡ªå‹•æ˜‡æ ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### FR-LEAD-4: Lead Scoring

**ã‚¹ã‚³ã‚¢ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯:**
```typescript
// è¨ºæ–­å›ç­”ã‹ã‚‰ã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
function calculateLeadScore(responses: Response[]): number {
  let totalScore = 0;
  let maxScore = 0;
  
  for (const response of responses) {
    const question = response.question;
    const answer = response.answer;
    
    // å›ç­”ã®é…ç‚¹ã‚’åŠ ç®—
    totalScore += answer.score;
    maxScore += question.max_score;
  }
  
  // 0-100ã«æ­£è¦åŒ–
  return Math.round((totalScore / maxScore) * 100);
}
```

**ã‚¹ã‚³ã‚¢æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼:**
1. è¨ºæ–­å®Œäº†æ™‚ã«è‡ªå‹•ç®—å‡º
2. æ‰‹å‹•ã‚¹ã‚³ã‚¢æ›´æ–°ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
3. è¤‡æ•°è¨ºæ–­å®Œäº†æ™‚ã¯å¹³å‡ã‚¹ã‚³ã‚¢

**ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰åˆ¤å®š:**
- ã‚¹ã‚³ã‚¢ >= 80: ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ï¼ˆğŸ”¥ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºï¼‰
- ã‚¹ã‚³ã‚¢ >= 80ã§è‡ªå‹•Teamsé€šçŸ¥

### FR-LEAD-5: Microsoft Teams Integration

**é€šçŸ¥ãƒˆãƒªã‚¬ãƒ¼:**
1. **ãƒªãƒ¼ãƒ‰ä½œæˆæ™‚**: ã‚¹ã‚³ã‚¢ >= 80
2. **ã‚¹ã‚³ã‚¢æ›´æ–°æ™‚**: é–¾å€¤è¶…ãˆï¼ˆ< 80 â†’ >= 80ï¼‰

**é€šçŸ¥å†…å®¹ï¼ˆAdaptive Cardï¼‰:**
```json
{
  "type": "AdaptiveCard",
  "body": [
    {
      "type": "TextBlock",
      "text": "ğŸ”¥ ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ç²å¾—ï¼",
      "weight": "bolder",
      "size": "large"
    },
    {
      "type": "FactSet",
      "facts": [
        { "title": "åå‰", "value": "ãƒ†ã‚¹ãƒˆå¤ªéƒ" },
        { "title": "ä¼šç¤¾", "value": "ãƒ†ã‚¹ãƒˆæ ªå¼ä¼šç¤¾" },
        { "title": "å½¹è·", "value": "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°éƒ¨é•·" },
        { "title": "ã‚¹ã‚³ã‚¢", "value": "95/100" },
        { "title": "è¨ºæ–­", "value": "å–¶æ¥­èª²é¡Œè¨ºæ–­" }
      ]
    }
  ],
  "actions": [
    {
      "type": "Action.OpenUrl",
      "title": "ãƒªãƒ¼ãƒ‰ã‚’è¦‹ã‚‹",
      "url": "https://app.diagnoleads.com/tenants/{tenant_id}/leads/{lead_id}"
    }
  ]
}
```

**è¨­å®š:**
- ãƒ†ãƒŠãƒ³ãƒˆåˆ¥Webhook URLï¼ˆ`tenant.settings.teams_webhook_url`ï¼‰
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆ`TEAMS_WEBHOOK_URL` ç’°å¢ƒå¤‰æ•°ï¼‰

---

## Non-Functional Requirements

### NFR-LEAD-1: Performance
- ãƒªãƒ¼ãƒ‰ä¸€è¦§ãƒ­ãƒ¼ãƒ‰ < 1ç§’
- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¿œç­” < 500ms
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° < 300ms
- Teamsé€šçŸ¥é€ä¿¡ < 2ç§’ï¼ˆéåŒæœŸï¼‰

### NFR-LEAD-2: Data Privacy
- ãƒ†ãƒŠãƒ³ãƒˆé–“ã§ãƒªãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æ¼æ´©ãªã—
- ãƒªãƒ¼ãƒ‰ã®å€‹äººæƒ…å ±ã¯æš—å·åŒ–ä¿å­˜
- GDPRæº–æ‹ ï¼ˆå‰Šé™¤æ¨©ã€å¿˜ã‚Œã‚‰ã‚Œã‚‹æ¨©åˆ©ï¼‰

### NFR-LEAD-3: Scalability
- 10,000+ ãƒªãƒ¼ãƒ‰/ãƒ†ãƒŠãƒ³ãƒˆã§ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¶­æŒ
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆ
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ï¼ˆtenant_id, score, created_atï¼‰

---

## API Endpoints

### List Leads
```
GET /api/v1/tenants/{tenant_id}/leads
Query Parameters:
  - status: string[] (new, contacted, qualified, ...)
  - score_min: number (0-100)
  - score_max: number (0-100)
  - is_hot: boolean
  - assessment_id: string
  - created_after: string (ISO 8601)
  - created_before: string (ISO 8601)
  - search: string
  - page: number (default: 1)
  - limit: number (default: 20)
  - sort_by: string (score, created_at, name)
  - sort_order: string (asc, desc)

Response: {
  "leads": [
    {
      "id": "uuid",
      "name": "ãƒ†ã‚¹ãƒˆå¤ªéƒ",
      "email": "test@example.com",
      "company": "ãƒ†ã‚¹ãƒˆæ ªå¼ä¼šç¤¾",
      "job_title": "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°éƒ¨é•·",
      "phone": "03-1234-5678",
      "score": 95,
      "status": "new",
      "is_hot": true,
      "assessment": {
        "id": "uuid",
        "title": "å–¶æ¥­èª²é¡Œè¨ºæ–­"
      },
      "created_at": "2025-11-10T14:30:00Z",
      "last_activity_at": "2025-11-10T14:30:00Z"
    }
  ],
  "total": 150,
  "page": 1,
  "limit": 20
}
```

### Get Lead Detail
```
GET /api/v1/tenants/{tenant_id}/leads/{lead_id}

Response: {
  "id": "uuid",
  "name": "ãƒ†ã‚¹ãƒˆå¤ªéƒ",
  "email": "test@example.com",
  "company": "ãƒ†ã‚¹ãƒˆæ ªå¼ä¼šç¤¾",
  "job_title": "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°éƒ¨é•·",
  "phone": "03-1234-5678",
  "score": 95,
  "status": "new",
  "assigned_to": null,
  "assessment": {
    "id": "uuid",
    "title": "å–¶æ¥­èª²é¡Œè¨ºæ–­",
    "completed_at": "2025-11-10T14:25:00Z"
  },
  "score_breakdown": [
    {
      "question": "ã‚ãªãŸã®èª²é¡Œã¯ï¼Ÿ",
      "answer": "ãƒªãƒ¼ãƒ‰ç²å¾—ãŒä¸è¶³",
      "score": 20,
      "max_score": 25
    }
  ],
  "activities": [
    {
      "id": "uuid",
      "type": "status_change",
      "from_status": "new",
      "to_status": "contacted",
      "user": { "id": "uuid", "name": "å–¶æ¥­å¤ªéƒ" },
      "created_at": "2025-11-11T10:00:00Z"
    }
  ],
  "notes": [
    {
      "id": "uuid",
      "content": "é›»è©±ã§ã‚³ãƒ³ã‚¿ã‚¯ãƒˆã€‚æ¥é€±é¢è«‡äºˆå®šã€‚",
      "user": { "id": "uuid", "name": "å–¶æ¥­å¤ªéƒ" },
      "created_at": "2025-11-11T10:15:00Z"
    }
  ],
  "created_at": "2025-11-10T14:30:00Z",
  "last_activity_at": "2025-11-11T10:15:00Z"
}
```

### Create Lead (Manual)
```
POST /api/v1/tenants/{tenant_id}/leads
Body: {
  "name": "æ‰‹å‹•ãƒªãƒ¼ãƒ‰",
  "email": "manual@example.com",
  "company": "æ‰‹å‹•æ ªå¼ä¼šç¤¾",
  "job_title": "éƒ¨é•·",
  "phone": "03-5678-1234",
  "score": 70
}

Response: {
  "id": "uuid",
  "name": "æ‰‹å‹•ãƒªãƒ¼ãƒ‰",
  ...
}
```

### Update Lead Status
```
PATCH /api/v1/tenants/{tenant_id}/leads/{lead_id}/status
Body: {
  "status": "contacted",
  "note": "é›»è©±ã§ã‚³ãƒ³ã‚¿ã‚¯ãƒˆæ¸ˆã¿"
}

Response: {
  "id": "uuid",
  "status": "contacted",
  "last_activity_at": "2025-11-11T10:00:00Z"
}
```

### Update Lead Score
```
PATCH /api/v1/tenants/{tenant_id}/leads/{lead_id}/score
Body: {
  "score": 90
}

Response: {
  "id": "uuid",
  "score": 90,
  "is_hot": true
}
```

### Add Lead Note
```
POST /api/v1/tenants/{tenant_id}/leads/{lead_id}/notes
Body: {
  "content": "ãƒ¡ãƒ¢å†…å®¹"
}

Response: {
  "id": "uuid",
  "content": "ãƒ¡ãƒ¢å†…å®¹",
  "user": { "id": "uuid", "name": "å–¶æ¥­å¤ªéƒ" },
  "created_at": "2025-11-11T10:15:00Z"
}
```

### Delete Lead
```
DELETE /api/v1/tenants/{tenant_id}/leads/{lead_id}

Response: 204 No Content
```

---

## UI/UX Design

### Lead List Page

**Layout:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒªãƒ¼ãƒ‰ç®¡ç†              [+ æ‰‹å‹•ä½œæˆ] [ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æ¤œç´¢] [ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹â–¼] [ã‚¹ã‚³ã‚¢â–¼] [è¨ºæ–­â–¼] [æ—¥ä»˜â–¼]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”¥â”‚åå‰      â”‚ä¼šç¤¾    â”‚ã‚¹ã‚³ã‚¢â”‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹â”‚ç²å¾—æ—¥  â”‚
â”œâ”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”¥â”‚ãƒ†ã‚¹ãƒˆå¤ªéƒâ”‚ãƒ†ã‚¹ãƒˆãˆ±â”‚ 95   â”‚æ–°è¦     â”‚11/10   â”‚
â”‚   â”‚éˆ´æœ¨èŠ±å­  â”‚ABCãˆ±   â”‚ 75   â”‚ã‚³ãƒ³ã‚¿ã‚¯ãƒˆâ”‚11/09   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ:**
- èƒŒæ™¯è‰²: `bg-orange-50`
- å¢ƒç•Œç·š: `border-l-4 border-orange-500`
- ã‚¢ã‚¤ã‚³ãƒ³: ğŸ”¥

### Lead Detail Page

**ã‚¿ãƒ–æ§‹æˆ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ†ã‚¹ãƒˆå¤ªéƒ (ãƒ†ã‚¹ãƒˆæ ªå¼ä¼šç¤¾)             â”‚
â”‚  [æ¦‚è¦] [è¨ºæ–­çµæœ] [ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  (é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã®å†…å®¹)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Structure

### Pages

```typescript
// frontend/src/pages/leads/LeadsPage.tsx
export function LeadsPage() {
  const { tenantId } = useParams();
  const [filters, setFilters] = useState<LeadFilters>({});
  const { data: leads, isLoading } = useLeads(tenantId, filters);
  
  return (
    <Layout>
      <LeadListHeader />
      <LeadFilters filters={filters} onChange={setFilters} />
      <LeadTable leads={leads} />
      <Pagination />
    </Layout>
  );
}

// frontend/src/pages/leads/LeadDetailPage.tsx
export function LeadDetailPage() {
  const { tenantId, leadId } = useParams();
  const { data: lead } = useLead(tenantId, leadId);
  const [activeTab, setActiveTab] = useState('overview');
  
  return (
    <Layout>
      <LeadHeader lead={lead} />
      <Tabs value={activeTab} onChange={setActiveTab}>
        <Tab value="overview">æ¦‚è¦</Tab>
        <Tab value="assessment">è¨ºæ–­çµæœ</Tab>
        <Tab value="activity">ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</Tab>
      </Tabs>
      <TabContent activeTab={activeTab} lead={lead} />
    </Layout>
  );
}
```

### Components

```typescript
// frontend/src/components/leads/LeadTable.tsx
interface LeadTableProps {
  leads: Lead[];
}

export function LeadTable({ leads }: LeadTableProps) {
  return (
    <table className="w-full">
      <thead>
        <tr>
          <th></th>
          <th>åå‰</th>
          <th>ä¼šç¤¾</th>
          <th>ã‚¹ã‚³ã‚¢</th>
          <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          <th>ç²å¾—æ—¥</th>
          <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
        </tr>
      </thead>
      <tbody>
        {leads.map(lead => (
          <LeadRow key={lead.id} lead={lead} />
        ))}
      </tbody>
    </table>
  );
}

// frontend/src/components/leads/LeadRow.tsx
interface LeadRowProps {
  lead: Lead;
}

export function LeadRow({ lead }: LeadRowProps) {
  const isHot = lead.score >= 80;
  
  return (
    <tr className={isHot ? 'bg-orange-50 border-l-4 border-orange-500' : ''}>
      <td>{isHot && 'ğŸ”¥'}</td>
      <td>
        <Link to={`/tenants/${lead.tenant_id}/leads/${lead.id}`}>
          {lead.name}
        </Link>
      </td>
      <td>{lead.company}</td>
      <td>
        <LeadScoreBadge score={lead.score} />
      </td>
      <td>
        <LeadStatusBadge status={lead.status} />
      </td>
      <td>{formatDate(lead.created_at)}</td>
      <td>
        <LeadActionMenu lead={lead} />
      </td>
    </tr>
  );
}

// frontend/src/components/leads/LeadScoreBadge.tsx
interface LeadScoreBadgeProps {
  score: number;
}

export function LeadScoreBadge({ score }: LeadScoreBadgeProps) {
  const color = score >= 80 ? 'red' : score >= 60 ? 'yellow' : 'gray';
  
  return (
    <Badge color={color}>
      {score}
    </Badge>
  );
}

// frontend/src/components/leads/LeadFilters.tsx
interface LeadFiltersProps {
  filters: LeadFilters;
  onChange: (filters: LeadFilters) => void;
}

export function LeadFilters({ filters, onChange }: LeadFiltersProps) {
  return (
    <div className="flex gap-4">
      <MultiSelect
        label="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"
        options={leadStatusOptions}
        value={filters.status}
        onChange={(status) => onChange({ ...filters, status })}
      />
      <RangeSlider
        label="ã‚¹ã‚³ã‚¢"
        min={0}
        max={100}
        value={[filters.score_min || 0, filters.score_max || 100]}
        onChange={([min, max]) => onChange({ ...filters, score_min: min, score_max: max })}
      />
      <Select
        label="è¨ºæ–­"
        options={assessmentOptions}
        value={filters.assessment_id}
        onChange={(assessment_id) => onChange({ ...filters, assessment_id })}
      />
      <DateRangePicker
        label="ç²å¾—æ—¥"
        value={[filters.created_after, filters.created_before]}
        onChange={([after, before]) => onChange({ 
          ...filters, 
          created_after: after, 
          created_before: before 
        })}
      />
    </div>
  );
}
```

---

## State Management

### Lead Queries (TanStack Query)

```typescript
// frontend/src/services/leadService.ts
export function useLeads(tenantId: string, filters: LeadFilters) {
  return useQuery({
    queryKey: ['leads', tenantId, filters],
    queryFn: () => leadService.list(tenantId, filters),
  });
}

export function useLead(tenantId: string, leadId: string) {
  return useQuery({
    queryKey: ['lead', tenantId, leadId],
    queryFn: () => leadService.get(tenantId, leadId),
  });
}

export function useUpdateLeadStatus() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: leadService.updateStatus,
    onSuccess: (data) => {
      queryClient.setQueryData(['lead', data.tenant_id, data.id], data);
      queryClient.invalidateQueries({ queryKey: ['leads'] });
    },
  });
}

export function useAddLeadNote() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: leadService.addNote,
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({ 
        queryKey: ['lead', variables.tenantId, variables.leadId] 
      });
    },
  });
}
```

---

## Business Logic

### Lead Scoring Logic (Backend)
```python
# backend/app/services/lead_service.py
def calculate_lead_score(response: Response) -> int:
    """
    è¨ºæ–­å›ç­”ã‹ã‚‰ãƒªãƒ¼ãƒ‰ã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
    """
    total_score = 0
    max_score = 0
    
    for answer in response.answers:
        question = answer.question
        option = answer.selected_option
        
        total_score += option.score
        max_score += question.max_score
    
    # 0-100ã«æ­£è¦åŒ–
    normalized_score = round((total_score / max_score) * 100)
    
    return normalized_score

async def create_lead_from_response(
    response: Response,
    tenant_id: UUID
) -> Lead:
    """
    è¨ºæ–­å›ç­”ã‹ã‚‰ãƒªãƒ¼ãƒ‰ã‚’ä½œæˆã—ã€ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ã®å ´åˆã¯Teamsé€šçŸ¥
    """
    score = calculate_lead_score(response)
    
    lead = Lead(
        tenant_id=tenant_id,
        name=response.user_info.name,
        email=response.user_info.email,
        company=response.user_info.company,
        job_title=response.user_info.job_title,
        phone=response.user_info.phone,
        score=score,
        status=LeadStatus.NEW,
        assessment_id=response.assessment_id,
    )
    
    db.add(lead)
    db.commit()
    
    # ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰ã®å ´åˆã€Teamsé€šçŸ¥
    if score >= 80:
        await send_hot_lead_notification(lead, tenant)
    
    return lead
```

### Teams Notification Logic
```python
# backend/app/services/lead_service.py
async def send_hot_lead_notification(lead: Lead, tenant: Tenant):
    """
    ãƒ›ãƒƒãƒˆãƒªãƒ¼ãƒ‰é€šçŸ¥ã‚’Teamsã«é€ä¿¡
    """
    webhook_url = (
        tenant.settings.get('teams_webhook_url') or 
        settings.TEAMS_WEBHOOK_URL
    )
    
    if not webhook_url:
        logger.warning(f"No Teams webhook configured for tenant {tenant.id}")
        return
    
    teams_client = TeamsWebhookClient(webhook_url)
    
    try:
        await teams_client.send_hot_lead_notification(
            lead_name=lead.name,
            company=lead.company,
            job_title=lead.job_title,
            score=lead.score,
            assessment_name=lead.assessment.title,
            lead_url=f"{settings.APP_URL}/tenants/{tenant.id}/leads/{lead.id}"
        )
        logger.info(f"âœ… Teams notification sent for lead {lead.id}")
    except Exception as e:
        logger.error(f"âš ï¸  Failed to send Teams notification: {str(e)}")
```

---

## Testing Strategy

### Unit Tests

**LeadTable Component:**
- [ ] Renders lead rows correctly
- [ ] Shows hot lead icon for score >= 80
- [ ] Highlights hot leads with background color

**LeadFilters Component:**
- [ ] Applies filters correctly
- [ ] Updates URL query params
- [ ] Resets filters

**Lead Scoring Logic:**
- [ ] Calculates score correctly
- [ ] Normalizes to 0-100 range
- [ ] Handles edge cases (no answers, invalid data)

### Integration Tests

**Lead List Flow:**
1. Navigate to leads page
2. Apply status filter
3. Verify filtered results
4. Click lead â†’ Navigate to detail page

**Lead Status Update:**
1. Open lead detail
2. Change status
3. Add note
4. Verify status updated
5. Verify activity log created

### E2E Tests

**Complete Lead Management Flow:**
1. Login
2. Navigate to leads
3. Filter by "hot leads"
4. Click first hot lead
5. View score breakdown
6. Update status to "contacted"
7. Add note
8. Verify activity log
9. Navigate back to list
10. Verify status updated in list

**Teams Notification Flow:**
1. Create lead with score 95
2. Verify Teams notification sent
3. Update lead score from 75 to 85
4. Verify Teams notification sent
5. Update lead score from 85 to 90
6. Verify NO duplicate notification

---

## Implementation Notes

### Critical Considerations

**1. Performance:**
- Large lead datasets (10,000+) require efficient indexing
- Paginationå¿…é ˆ
- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å®Ÿè¡Œï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å…¨ä»¶å–å¾—ã—ãªã„ï¼‰

**2. Data Privacy:**
- ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ã‚’å³å¯†ã«å®Ÿæ–½
- å€‹äººæƒ…å ±ã®æš—å·åŒ–
- GDPRæº–æ‹ ï¼ˆå‰Šé™¤è¦æ±‚ã¸ã®å¯¾å¿œï¼‰

**3. Teams Integration:**
- é€šçŸ¥å¤±æ•—ã§ã‚‚ãƒªãƒ¼ãƒ‰ä½œæˆã¯æˆåŠŸã•ã›ã‚‹
- éåŒæœŸå‡¦ç†ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ï¼‰
- ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ3å›ã¾ã§ã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰

**4. Scalability:**
- PostgreSQLã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–:
  ```sql
  CREATE INDEX idx_leads_tenant_score ON leads(tenant_id, score DESC);
  CREATE INDEX idx_leads_tenant_status ON leads(tenant_id, status);
  CREATE INDEX idx_leads_tenant_created ON leads(tenant_id, created_at DESC);
  ```

---

## Related Specifications

- [System Core Features](./system-core.md)
- [Assessment Features](./assessment-features.md)
- [Microsoft Teams Integration](../../specs/features/microsoft-teams-integration.md)
- [Analytics Dashboard](../../specs/features/analytics-dashboard.md)

---

## Changelog

| Date | Version | Changes |
|------|---------|---------|
| 2025-11-11 | 1.0 | Initial specification |

---

**Status**: âœ… Ready for Review  
**Next Steps**: Review â†’ Approve â†’ Implement
