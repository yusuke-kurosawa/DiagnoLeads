# DiagnoLeads - Session Summary

**最終更新**: 2025-11-17
**プロジェクトバージョン**: 0.1.0 (MVP)

## 📊 プロジェクト概要

DiagnoLeadsは、B2B企業向けのマルチテナント診断サービスプラットフォームです。複数の事業者（テナント）が独立した環境で診断コンテンツを作成・運用し、Webサイトに埋め込んで見込み顧客を獲得できます。

## 🎯 現在の開発状況

### ✅ 実装完了機能

#### コア機能
- **マルチテナントアーキテクチャ**: テナントID による論理分離、Row-Level Security (RLS)
- **認証・認可**: JWT ベースの認証、テナント管理者・一般ユーザー・システム管理者の3つのロール
- **診断管理（Assessment CRUD）**: 診断の作成、編集、削除、一覧表示
- **リード管理**: 見込み顧客情報の管理、スコアリング
- **分析ダッシュボード**: 基本的な診断完了率、CVファネルの可視化

#### マスタ管理機能
- **トピック管理**: 診断トピックのCRUD、ドラッグ&ドロップソート、テナント固有データ
- **業界管理**: 業界マスタのCRUD、ドラッグ&ドロップソート、テナント固有データ
- **ユーザー管理**: ユーザーの作成、編集、削除、権限管理
- **テナント管理**: テナント情報の管理、契約プラン設定

#### UI/UX改善
- **エラーハンドリング**: 包括的なエラーページ（404、500など）、エラーロギング強化
- **フォームレイアウト最適化**: すべてのフォームラベルを左寄せに統一
- **サイドバーメニュー**: 設定をマスタ管理の後に配置、論理的な順序に改善
- **カラーインジケーター**: トピックと業界のドロップダウンに色表示機能追加
- **システム環境設定**: タクソノミーページをシステム環境設定に置換

#### 開発インフラ
- **監査ログ**: アクセス制御の改善、CORS対応、500エラー解決
- **SQLAlchemy モデル**: リレーションシップの修正、マッパー設定エラー解決
- **サンプルデータ**: トピックと業界のサンプルデータ作成スクリプト

### 🚧 進行中・計画中

#### Phase 1 準備（仕様策定完了）
以下の革新的機能の仕様は策定済みですが、実装はこれからです：

- **Microsoft Teams 統合**: Adaptive Cards通知、Bot対話型診断
- **マルチチャネル配信**: LINE、SMS、QRコード/NFC
- **AI A/Bテスト自動化**: トンプソンサンプリング、自動最適化
- **リアルタイムコラボレーション**: Google Docs風の共同編集
- **診断マーケットプレイス**: テンプレート共有
- **AI診断生成**: Claude APIによる自動生成（仕様のみ）
- **AIリード分析**: 企業課題の自動検出（仕様のみ）

詳細: [革新的機能提案](../openspec/changes/2025-11-10-innovative-features/innovative-features.md)

## 📈 開発の進捗

### 最近の主要な改善（直近20コミット）

1. **エラーハンドリングの強化** (2025-11-17)
   - 包括的なエラーページの実装
   - エラーロギングの改善
   - ユーザーフレンドリーなエラーメッセージ

2. **UI/UX の統一** (2025-11-17)
   - すべてのフォームラベルを左寄せに統一
   - 一貫性のあるユーザー体験を提供

3. **マスタ管理機能の完成** (2025-11-16 - 2025-11-17)
   - トピックと業界のドラッグ&ドロップソート機能
   - 部分更新のサポート（sort_orderのみの更新可能）
   - カラーインジケーター表示
   - システム管理者が全テナントのユーザーを閲覧可能

4. **監査ログの改善** (2025-11-15)
   - CORSエラーと500エラーの解決
   - テーブル作成とアクセス制御の改善

5. **データモデルの修正** (2025-11-15)
   - SQLAlchemyのリレーションシップエラー解決
   - テナント関連付けの追加

## 🏗️ アーキテクチャ

### 技術スタック

**フロントエンド**
- React 18 + Vite + TypeScript
- Zustand (状態管理) + TanStack Query (サーバー状態)
- Tailwind CSS + shadcn/ui

**バックエンド**
- FastAPI (Python 3.11+)
- SQLAlchemy 2.0
- PostgreSQL (Supabase)
- Redis (Upstash)

**AI機能（計画中）**
- Anthropic Claude API (Claude 3.5 Sonnet)

### データモデル

主要エンティティ:
- **Tenant**: テナント情報、契約プラン
- **User**: ユーザー情報、ロール、権限
- **Assessment**: 診断コンテンツ
- **Question**: 質問、回答選択肢
- **Response**: ユーザー回答データ
- **Lead**: 見込み顧客情報、スコア
- **Topic**: 診断トピックマスタ
- **Industry**: 業界マスタ
- **AuditLog**: 監査ログ

## 🎯 次のステップ

### 短期目標（1-2週間）
1. **AI診断生成機能の実装開始**
   - Claude API 統合
   - プロンプトエンジニアリング
   - 診断生成UIの開発

2. **埋め込みウィジェットのプロトタイプ**
   - Web Components による実装
   - Shadow DOMでのスタイル分離

3. **テストカバレッジの向上**
   - バックエンド単体テスト
   - フロントエンド統合テスト

### 中期目標（1-3ヶ月）
1. **Phase 1 革新的機能の実装開始**
   - Microsoft Teams統合の技術検証
   - LINEアカウント連携の準備
   - AI A/Bテストエンジンの設計

2. **パフォーマンス最適化**
   - データベースクエリの最適化
   - フロントエンドのコード分割

## 📚 関連ドキュメント

- [CLAUDE.md](../CLAUDE.md) - 開発ガイドライン
- [README.md](../README.md) - プロジェクト概要
- [OpenSpec仕様](../openspec/specs/) - 詳細仕様
- [革新的機能提案](../openspec/changes/2025-11-10-innovative-features/innovative-features.md)

## 🔍 課題と検討事項

### 技術的課題
- AI API のコスト管理（従量課金）
- マルチテナント環境でのデータ分離の徹底
- 埋め込みウィジェットのパフォーマンス最適化

### ビジネス課題
- MVP のスコープ定義
- Phase 1 革新的機能の優先順位付け
- 初期ターゲット顧客の選定

## 📊 メトリクス

### コード品質
- バックエンド: 基本的なテストカバレッジあり
- フロントエンド: テスト整備中
- リント・フォーマット: Ruff (backend), ESLint (frontend)

### インフラ
- CI/CD: GitHub Actions 設定済み
- ホスティング: Railway (backend), Vercel (frontend) 準備中
- データベース: Supabase 設定済み

---

**Built with ❤️ using OpenSpec Spec-Driven Development**
