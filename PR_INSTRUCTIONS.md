# PRä½œæˆæ‰‹é †

ä»¥ä¸‹ã®URLã§PRã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š

https://github.com/yusuke-kurosawa/DiagnoLeads/compare/main...feature/database-integrity-management?expand=1

## PRã‚¿ã‚¤ãƒˆãƒ«
```
feat(database): Database Integrity Management System
```

## PRèª¬æ˜æ–‡

ä»¥ä¸‹ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼š

---

## ğŸ“‹ æ¦‚è¦

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®å“è³ªã‚’ç¶™ç¶šçš„ã«ä¿è¨¼ã™ã‚‹åŒ…æ‹¬çš„ãªç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’å°å…¥ã—ã¾ã™ã€‚

## ğŸ¯ ç›®çš„

- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®ä¸€è²«æ€§ã‚’ä¿è¨¼
- å­¤å…ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆOrphan Recordsï¼‰ã®è‡ªå‹•æ¤œå‡º
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§ã®ç¶™ç¶šçš„ãªç›£è¦–
- PRã”ã¨ã®è‡ªå‹•æ¤œè¨¼ã§ãƒ‡ãƒ¼ã‚¿å“è³ªã‚’å‘ä¸Š

## âœ¨ ä¸»ãªå¤‰æ›´å†…å®¹

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
`backend/scripts/validate_database_integrity.py`
- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®å­˜åœ¨ã¨ ondelete å‹•ä½œã‚’æ¤œè¨¼
- å­¤å…ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•æ¤œå‡º
- ä¸€æ„åˆ¶ç´„ã€ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ã®æ¤œè¨¼
- SQLAlchemy ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã®åŒæ–¹å‘æ€§ãƒã‚§ãƒƒã‚¯

### 2. CI/CD ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
`.github/workflows/database-integrity.yml`
- PRä½œæˆæ™‚ã«è‡ªå‹•å®Ÿè¡Œ
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ãƒ†ã‚¹ãƒˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§æ¤œè¨¼
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç«¶åˆãƒã‚§ãƒƒã‚¯
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½æ€§ãƒ†ã‚¹ãƒˆ
- æ¤œè¨¼çµæœã‚’PRã«ã‚³ãƒ¡ãƒ³ãƒˆ

### 3. PR ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
`.github/pull_request_template.md`
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´ã®åŒ…æ‹¬çš„ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®ç¢ºèªé …ç›®
- OpenAPIå¤‰æ›´ã®ç¢ºèªé …ç›®
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

### 4. OpenSpec ææ¡ˆæ›¸
`openspec/changes/database-integrity-management/`
- è©³ç´°ãªææ¡ˆæ›¸ï¼ˆproposal.mdï¼‰
- å®Ÿè£…ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼ˆtasks.mdï¼‰

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®æ¤œè¨¼
cd backend
python scripts/validate_database_integrity.py
```

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

- ğŸ¯ å­¤å…ãƒ¬ã‚³ãƒ¼ãƒ‰ç™ºç”Ÿç‡: 0ä»¶/æœˆ
- ğŸ¯ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§é•å: 0ä»¶/ãƒªãƒªãƒ¼ã‚¹
- ğŸ¯ æœ¬ç•ªç’°å¢ƒã§ã®ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚¨ãƒ©ãƒ¼: 90%å‰Šæ¸›

## ğŸ“ é–¢é€£

- OpenSpecææ¡ˆ: `openspec/changes/database-integrity-management/proposal.md`
- å®Ÿè£…ã‚¿ã‚¹ã‚¯: `openspec/changes/database-integrity-management/tasks.md`

## ğŸ”„ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆPhase 2 & 3ï¼‰

ã“ã®PRãƒãƒ¼ã‚¸å¾Œã€ä»¥ä¸‹ã‚’æ®µéšçš„ã«å®Ÿè£…äºˆå®šï¼š
- Phase 2: OpenAPIå³æ ¼æ¤œè¨¼ï¼ˆSpectralã€Breaking Changeæ¤œå‡ºï¼‰
- Phase 3: ERå›³è‡ªå‹•ç”Ÿæˆã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è£œåŠ©ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

---

## ãƒ©ãƒ™ãƒ«

ä»¥ä¸‹ã®ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼š
- `enhancement`
- `database`
- `ci-cd`
